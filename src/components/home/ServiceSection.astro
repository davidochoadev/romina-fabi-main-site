---
import fetchNotionData from "../../utils/fetchNotionData"
import type MenuItem from "../../interfaces/menuItems";
import type {Block, BlockResponse} from "../../interfaces/tableRow";
import { Image } from "astro:assets";
import logo from "../../assets/logo.png";
import { marked } from "marked";

import consulenze from "../../assets/consulenze.webp";
import trattamenti from "../../assets/trattamenti.webp";
import percorsi from "../../assets/percorsi.webp";

import Section from "./components/Section.astro";

interface Servizio {
   denominazione: string,
   descrizioneServizio: string,
   isAvailable: string,
   buttonLink: string,
   buttonTxt: string,
}

const serviceSectionEnv = import.meta.env.SERVICE_SECTION_ENV;
const data = await fetchNotionData(serviceSectionEnv, "blocks", true);

const titoliServizi = data.results.map((list:Block) => list.table_row.cells![0][0].plain_text);
const descrizioneServizi = data.results.map((list:Block) => list.table_row.cells![1][0].plain_text);
const buttonTxt = data.results.map((list:Block) => list.table_row.cells![2][0].plain_text);
const buttonLink = data.results.map((list:Block) => list.table_row.cells![3][0].plain_text);
const isAvailable = data.results.map((list:Block) => list.table_row.cells![4][0].plain_text);

const servizi = titoliServizi.map((servizio : string, index : number) => ({
       denominazione: servizio,
       descrizioneServizio: descrizioneServizi[index] || '',
       isAvailable: isAvailable[index] === 'True',
       buttonLink: buttonLink[index],
       buttonTxt: buttonTxt[index],
   }));
console.log(servizi)
---
<!-- <section aria-label="Servizi offerti" class="px-4 py-6 min-h-screen max-w-screen flex flex-col items-center justify-center bg-white lg:p-[100px] border border-t-gold">
   <div class="flex flex-col gap-2 items-center justify-end w-full py-6">
      <h4 class="sottotitolo spacing">SERVIZI</h4>
      <h3 class="text-5xl playfair text-center">Prodotti Disponibili</h3> 
   </div>
   <div class="flex flex-col gap-12 py-6"> -->
<Section ariaLabel="Servizi Offerti" title="Prodotti Disponibili" subtitle="SERVIZI">
   {
      servizi.map((servizio : Servizio) => (
         <article class="shadow-lg rounded-3xl bg-white grid grid-rows-2 md:flex md:flex-row max-w-[1070px] max-h-[700px] md:max-h-[470px] drop-shadow-md border border-gold">
            <div class=" max-w-[300px] md:max-w-[400px] lg:max-h-[800px] flex flex-col items-center justify-center justify-self-center card_image" >
               <img src={servizio.denominazione === 'Consulenze' ? 'https://res.cloudinary.com/dk6qm2dhs/image/upload/f_auto,q_70/v1/homepage/mreklf24albfwwi0qjkn' : 
                           servizio.denominazione === 'Trattamenti' ? 'https://res.cloudinary.com/dk6qm2dhs/image/upload/f_auto,q_70/v1/homepage/pttl7dfhoeftlbg1hcdv' : "https://res.cloudinary.com/dk6qm2dhs/image/upload/f_auto,q_70/v1/homepage/yo19b083ioenghgiigts"}
                     alt={`Rappresentazione ${servizio.denominazione}`} />
            </div>
            <div class="grid grid-rows-3 items-center justify-center content-center place-content-center">
               <div class="w-full h-full flex flex-col items-center justify-center md:justify-end">
                  <h4 class="text-center text-4xl md:text-4xl">{servizio.denominazione}</h4>
               </div>
               <div class="text-center text-zinc px-4 md:px-12 py-6 md:py-4 text-sm md:text-base border-gold border-t border-b md:border-0" set:html={servizio.descrizioneServizio}>
               </div>
               <div class="w-full h-full flex justify-center items-center md:items-start">
                  {servizio.isAvailable ? (
                     <a href={servizio.buttonLink} class="button spacing">{servizio.buttonTxt}</a>
                  ) : (<button class="button-not-available spacing">Non disponibili</button>)}
               </div>
            </div>
         </article>
      ))
   }
</Section>
<!--    </div>
</section> -->
<style>
   .card_image > img{
      border-radius: 1.5rem;
      border: solid 1px #d5b33d;
      transform: scale(1.05);
   }
</style>